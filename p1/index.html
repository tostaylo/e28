<!DOCTYPE html>
<html>
	<head>
		<title>Project 1</title>
		<script src="https://unpkg.com/vue"></script>
	</head>
	<body>
		<div id="app"></div>

		<script>
			Vue.component('guess-input', {
				props: ['guess'],
				template: `<label>
                    Enter your guess
                     <input v-bind:value="guess" v-on:keyup.enter="$emit('enter')" v-on:input="$emit('typing', $event.target.value)" type="text"></input>
                   <button v-on:click="$emit('enter')">Submit</button>
                   </label>`,
			});

			Vue.component('game-history', {
				props: ['gameHistory'],
				template: `<div> 
                     <p>Computer: {{gameHistory.computer}}</p>
                     <p>Player: {{gameHistory.player}}</p>
                   </div>`,
			});
			var app = new Vue({
				el: '#app',
				data: {
					counter: 0,
					guess: '',
					guesses: [],
					secretWord: [],
					gameState: { won: null },
					gameHistory: { computer: 0, player: 0 },
				},
				methods: {
					calculateGuess() {
						if (!this.secretWord.includes(this.guess) || this.guesses.includes(this.guess)) {
							this.counter += 1;
						}
						this.guesses.push(this.guess);
						this.guess = '';
						const hasWon = this.secretWord.every((letter) => this.guesses.includes(letter));
						if (hasWon) {
							//you won
							this.gameState = { won: true };
							this.gameHistory.player += 1;
						} else if (this.counter >= 6) {
							// you lost
							this.gameState = { won: false };
							this.gameHistory.computer += 1;
						}
					},
					resetGame() {
						this.guesses = [];
						this.gameState.won = null;
						this.counter = 0;
						this.generateRandomWord();
					},
					resetHistory() {
						this.gameHistory = { computer: 0, player: 0 };
					},

					generateRandomWord() {
						const words = [
							'bats',
							'barbells',
							'antelope',
							'avenger',
							'snack',
							'session',
							'frostbite',
							'purple',
							'detroit',
							'catacomb',
							'invisible',
						];

						this.secretWord = words[Math.floor(Math.random() * words.length + 0)].split('');
					},
				},
				computed: {
					revealLetter() {
						return this.secretWord.map((letter) => (this.guesses.includes(letter) ? letter : '_'));
					},
					guessesLeft() {
						return 6 - this.counter;
					},
					gameStateMessage() {
						return this.gameState.won ? 'You Won' : 'You Lost';
					},
				},
				created() {
					this.generateRandomWord();
				},

				template: `<div>
                        <div>
                          <span v-for="letter in revealLetter">{{letter}}</span>
                              <p>{{guessesLeft}} attempts remaining</p>
                        </div>
			                 <guess-input v-show="gameState.won === null" v-on:enter="calculateGuess" v-on:typing="guess = $event" v-bind:guess='guess'></guess-input>
                       <h3 v-show="gameState.won != null">{{gameStateMessage}}</h3>
                       <game-history v-bind:gameHistory="gameHistory"></game-history>
                       <button v-show="gameState.won != null" v-on:click="resetGame"> Play again </button>
                       <button v-on:click="resetHistory"> Reset History </button>
			              </div>`,
			});
		</script>
	</body>
</html>
